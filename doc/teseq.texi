\input texinfo   @c -*-texinfo-*-
@c %**start of header
@setfilename teseq.info
@include version.texi
@settitle Teseq @value{VERSION} Manual
@paragraphindent asis

@macro six
@cindex standards
@cindex Ecma-6
@cindex ISO 646
Ecma-6@tie{}/ ISO@tie{}646
@end macro

@macro thirtyfive
@cindex standards
@cindex Ecma-35
@cindex ISO/IEC@tie{}2200
Ecma-35@tie{}/ ISO/IEC@tie{}2200
@end macro

@macro fortyeight
@cindex standards
@cindex Ecma-48
@cindex ISO/IEC@tie{}6429
Ecma-48@tie{}/ ISO/IEC@tie{}6429
@end macro

@ifinfo
@macro th{content}
\content\@tie{}@tie{}|
@end macro
@end ifinfo
@ifnotinfo
@macro th{content}
@strong{\content\}
@end macro
@end ifnotinfo

@defcodeindex op
@syncodeindex op cp
@c %**end of header

@dircategory Miscellaneous
@direntry
* teseq: (teseq).               Terminal control sequence analyzer.
* reseq: (teseq)Reseq.          Reverse-translate output from teseq.
@end direntry

@copying
This manual is for Teseq, version @value{VERSION}.

Copyright @copyright{} 2008 Micah Cowan <@email{micah@@cowan.name}>

@quotation
Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.2
or any later version published by the Free Software Foundation;
with no Invariant Sections, no Front-Cover Texts, and no Back-Cover
Texts.  A copy of the license is included in the section entitled
``GNU Free Documentation License''.
@end quotation
@end copying

@titlepage
@title Teseq @value{VERSION} Manual
@author by Micah Cowan <@email{micah@@cowan.name}>

@c  The following two commands
@c  Start the copyright page.
@page
@vskip 0pt plus 1filll
@insertcopying

@end titlepage

@c So the toc is printed at the start.
@contents

@ifnottex
@node Top, Overview, (dir), (dir)
@top Teseq

This manual is for Teseq, version @value{VERSION}.

@noindent
Copyright @copyright{} 2008 Micah Cowan @email{micah@@cowan.name}
@end ifnottex

@menu
* Overview::                    What does Teseq do? (with example)
* Invoking Teseq::              How to run Teseq, with options 'n' stuff.
* Output Format::               How Teseq's output looks.
* Standards::                   The official word on control functions.

* Reseq::                       Reversing Teseq's output.

* Future Directions::           Future features under consideration.

* Copying::                     Copying and sharing this manual.
* Index::                       Index of concepts.
@end menu

@node Overview, Invoking Teseq, Top, Top
@chapter Overview
@cindex control character
@cindex control sequence
@cindex terminal
@cindex terminal emulator

Teseq is a tool for translating files that contain control characters
and terminal control sequences, into human-understandable text. It is
intended to aid in debugging problems in terminal emulators, software
that makes use of special terminal features, and interactions between
the two.

It is primarily targeted at individuals who possess a basic
understanding of terminal control sequences, especially
@cindex @sc{csi}
@cindex Control Sequence Introducer
@acronym{@sc{csi}} sequences; however, by default Teseq will try to
identify and describe the sequences that it encounters, and the
behavior they might produce in a terminal.

Teseq describes control functions as they are interpreted by
VT100-compatible terminals, and/or terminals compliant with the
@fortyeight{} standard. Teseq does @emph{not} support describing
control functions according to terminal-specific definitions in a
database such as
@cindex termcap
termcap or
@cindex terminfo
terminfo, though future versions may
include limited support for that (@pxref{Future Directions}).
Therefore, the descriptions Teseq uses for control functions may not
necessarily match their actual interpretation by whatever terminal
device the characters were actually intended for.

@unnumberedsec A Quick Example
@cindex examples
@cindex terminal
@cindex Hello, world!

You can't beat a short example to demonstrate what a program does, so
here goes. Suppose you've got a program that writes the following
output to a terminal.

@example
@strong{Hi} @r{there, world}
@end example

@noindent
A simple text string, using a boldface font to render the first word.

Suppose that, after a moment or two, the program then replaced the
final word ``world'' with the word ``earth''.

In order to achieve this effect, the program would have to send
special controls to the terminal to ask it to start writing in bold
text, and then to revert back to normal text for the rest. To replace
the final word, it might have to issue a series of backspaces before
issuing the replacement word. All of this will be handled
transparently by the terminal, and you wouldn't see any of the special
characters the program sent to the terminal---unless perhaps you
convinced the program to write to a text file as if it were writing to
a terminal, or ran the program under a terminal capture utility such
as the
@cindex @command{script}
@command{script} command.

You may be able to produce this effect yourself with the following
shell command.

@example
$ printf '\033[1mHi\033[m there, world'; sleep 1; \
    printf '\b\b\b\b\bearth\n'
@end example

@noindent
If you were to examine the output from such a command with a text
editor, it might look something like this.

@example
^[[1mHi^[[m there, world^H^H^H^H^Hearth
@end example

@noindent
Not very readable, is it? That's where teseq comes in! When you run
that gibberish through the @command{teseq} command with the default
settings, you'll get the following output.

@example
: Esc [ 1 m
& SGR: SELECT GRAPHIC RENDITION
" Set bold text.
|Hi|
: Esc [ 0 m
& SGR: SELECT GRAPHIC RENDITION
" Clear graphic rendition to defaults.
| there, world|
. BS/^H BS/^H BS/^H BS/^H BS/^H
|earth|.
@end example

@cindex line prefixes
@cindex prefixes
@noindent
Note that the special control sequences that tell the terminal to start
and stop writing in boldface text are separated out on their own lines
(prefixed with a colon @samp{:}), and followed by an identification
(prefixed with an ampersand @samp{&}) and a description of what it
does (prefixed with a quote character @samp{"}).

The actual text appears in lines bracketed by pipe @samp{|}
characters.

The series of single-character backspace controls appear on a line
prefixed with a period @samp{.}, identified by its identifying acronym
(@sc{bs} for @sc{backspace}), and its control-key representation
(Control-H).

The final word, ``earth'', is followed by a period just
after the closing pipe symbol; this indicates a following linefeed (or
``newline'') character.

@cindex @command{reseq}
The @command{reseq} command may be used to reverse the procedure,
accepting the above input and printing out the original set of escape
sequences that produced it. @xref{Reseq}.

@node Invoking Teseq, Output Format, Overview, Top
@chapter Invoking Teseq
@cindex invoking
@cindex options
@cindex usage
@cindex help

The format for running the @code{teseq} program is:

@example
teseq @var{options} [@var{input-file}] [@var{output-file}]
teseq -h | --help
teseq -V | --version
@end example

@noindent
If @var{input-file} or @var{output-file} is unspecified, or specified
as @samp{-}, standard input/output is used. Output is written to
standard output by default, but see the @option{-o} option.

@table @option
@item --help
@itemx -h
@opindex --help
@opindex -h
Print usage information on standard output and exit successfully.

@item --version
@itemx -v
@opindex --version
@opindex -v
Print the version number and licensing information of @code{hello} on
standard output and then exit successfully.

@item -C
@opindex -C
@cpindex control character
For control characters from the C0 set of @fortyeight{}, don't write
the control-key representation, only the identifying acronym. For
example, write the carriage-return/line-feed combination as
@example
. CR LF
@end example
@noindent
rather than
@example
. CR/^M LF/^J
@end example

@item -L
@opindex -L
@cpindex label line
Don't print identifying labels (lines beginning with @samp{&}) for
escape sequences.

@item -D
@opindex -D
@cpindex description line
Don't print description lines (those beginning with @samp{"}).

@item -E
@opindex -E
@cpindex escape-sequence line
Don't print escape-sequence lines (beginning with
@samp{:}). @strong{Warning:} this results in loss of information, and in
particular means that running the output through the
@cindex @command{reseq}
@command{reseq} command won't reproduce the input.

Still, this option can be useful (in combination with @option{-L}) for
those that don't care about the exact sequence of characters, or what
their function is called, but just what their effects in the terminal
are (those that Teseq understands). The output produced 

@end table

@noindent
Note that there are no options for suppressing
@cpindex text line
text lines (@samp{|})
or
@cpindex control-character line
control-character lines (@samp{.}),
as there are for description or
escape-sequence lines.

The @option{-L}, @option{-D} and @option{-E} options also have
mnemonic equivalents of
@opindex -&
@option{-&},
@opindex -"
@option{-"} and
@opindex -:
@option{-:}
respectively, corresponding to the
@cindex line prefix
@cindex prefix, line
character prefixes for the lines they suppress; and @option{-C} has an
@opindex -^
@option{-^} equivalent, for the @samp{^X}-style control
representations it suppresses. However, while they may be more practical to remember, they
will be less practical to type, since both @option{-&} and @option{-"}
are apt to be interpreted as special by the shell, and must be quoted
in order to pass them to the @command{teseq} command.

@node Output Format, Standards, Invoking Teseq, Top
@chapter Output Format

Teseq produces output that is primarily intended to be read by humans
(from input that is usually not). For this reason, Teseq's output
follows the following principles:

@itemize
@item
Displays for different sorts of characters and sequences are displayed
on distinct lines, and are easily distinguished by
@cindex line prefix
@cindex prefix, line
the initial character.
@item
Every input character should be unambiguously visible to the user in
the output (except, of course, when the user explicitly asks not to
see them, as with the @option{-E} option). In particular, trailing
space should be visible.
@item
Line lengths are limited to a maximum of 78 characters, so as to fit
comfortably on most terminal displays.
@item
The output makes clear distinction between line breaks that occur due
to line limits or intermixed character types, and those that actually
occurred in the input.
@end itemize

@ref{Overview} for an output example.

@menu
* Text Lines::                  
* Control-Character Lines::     
* Escape-Sequence Lines::       
* Label Lines::                 
* Description Lines::           
@end menu

@node Text Lines, Control-Character Lines, Output Format, Output Format
@section Text Lines

@opindex |
Lines of plain text input, are output between a pair of pipe characters
@samp{|}, with a final period to indicate the linefeed character.
Input:

@example
Hello there
@end example

@noindent
Output:

@example
|Hello there|.
@end example

@noindent
Trailing whitespace is thus made plainly visible to the reader.

@example
|Trailing space:    |.
@end example

@noindent
A blank line is represented as empty content between the pipes.

@example
||.
@end example

@noindent
If the input line is too long to display as one line of output, it
will be displayed as follows, with dash characters, @samp{-}, to
mark continuity at the beginnings and ends of the lines (outside the
pipe characters).

@example
|This input line |-
-|was too long to|-
-| fit|.
@end example

You might wonder whether pipe characters themselves might have to be
escaped, so as to avoid confusion with the surrounding pipes. After
all, in a C string literal, denoted by double-quotes, @samp{"}, one
must escape literal double-quote characters by preceding them with a
backslash (and must then also escape literal backslashes): @code{"She
said \"no\""}. However, no such escaping mechanism is needed in Teseq.
Input:

@example
A line with a pipe | in it, and a line with just a pipe
|
@end example

@noindent
Output:

@example
|A line with a pipe | in it, and a line with just a pipe|.
|||.
@end example

@noindent
No special treatment whatsoever!

The reason Teseq can get away with this is that the pipe character only
has its special ``mark the enclosed as normal text'' meaning, when it
is the first and the last character on a line of output (aside from a
possible prefacing dash to indicate a wrapped line, or a trailing dash
or period).

A lot of the output lines you've seen so far have all ended with a
period, denoting the linefeed character. However, this isn't always
the case. For instance, if the input line contains a control
character, Teseq will close the text line (with just a pipe, no
period), print a control-character line with the control characters,
and then finish up the rest of the text line. The following sample
output represents a single line which contains a delete character and
a null character:

@example
|Fee fi|
. DEL/^?
|fo|
. NUL/^@@
|fum|.
@end example

@noindent
And here's a line that's terminated with a carriage-return/line-feed
combination, rather than just a linefeed.

@example
|The promised line|
. CR/^M LF/^J
@end example

@noindent
The linefeed character is special: when it's preceded by control
characters or escape sequence, it's printed as a control character;
when it's preceded by text characters (or by nothing at all), it's
printed as that final dot thing. This behavior is designed to make a
newline look like the end of a line or a blank line when it should,
and to look like a control character when it should.

And of course, if the final line in the file is missing a newline, the
dot won't appear there either.

Currently, the only characters included in text lines, are those from
the printable range of characters from US
@cindex standards
@cindex ASCII
ASCII (@six{})---and sometimes linefeed, represented by the special
final-dot notation. This means that if the terminal was using a
character set that high-value code points, all high-valued bytes will
be represented in hexadecimal on control-character lines, and not
displayed on a text line. Future versions of Teseq may provide options
allowing for these characters to be represented properly in text
lines, but for now, the output format is ASCII characters only.
@xref{Future Directions}.

Note that even characters falling in the normal range of ASCII
printable characters may not necessarily be represented correctly: for
instance, if escape codes are present in the input that would switch
the terminal to a different national variant of @six{}, then the real
terminal might display (say, for ISO-646ES)
@ifnotinfo
@samp{@~{N}}
@end ifnotinfo
@ifinfo
the LATIN CAPITAL LETTER N WITH TILDE
@end ifinfo
instead of
@samp{[}; but the output from Teseq will not change based on this (even
though it will recognize and identify the control sequences that
invoke that character set for use).

@node Control-Character Lines, Escape-Sequence Lines, Text Lines, Output Format
@section Control-Character Lines
@cindex control character
@cindex control-character line

Control-character lines are used to display characters whose code
values fall outside the range of printable characters from US
@cindex standards
@cindex ASCII
ASCII
(@six{}). That
is, those characters whose code values fall below below 32 decimal
(that is, those from the C0 set of control characters from
@fortyeight{}); and those whose values are at or above 127 decimal
(the ``delete'' character, and character byte values with the high bit
set).

@opindex .
Control-character lines begin with an initial dot, @samp{.}, followed by the
control characters or high-value bytes being represented.

@example
. BEL/^G NUL/^@ CR/^M LF/^J DEL/^? xA0 xFF
@end example

@noindent
Control characters (whose numeric codes fall below decimal 32, plus
the delete character at decimal 127) are represented by a mnemonic
acronym identifying the character's function. Unless the
@opindex -C
@option{-C} was given, this acronym is followed by a slash, and the
control-key combination that would produce the corresponding character
(control characters are usually much more recognizable from one or the
other of their name or their control-character representation, than
they are by their hexadecimal code value). The ``control-key
combination'' representation consists of a ``hat'' or ``circumflex
accent'' character, followed by a character with a value in the range
of 63 through 95 decimal.

@cindex delete character
Note that the delete character, designated as
@samp{DEL/^?}, is a special case, in that one can not generally
reproduce that key by holding down the control key and typing a
question mark; it is simply used as an identification of the
key.

Other values (high-value bytes) are represented by the lowercase
letter @samp{x} followed by the two-digit hexadecimal code value for
the character.

For reference, here's a table of the control characters (plus
@sc{del}). It is based on the information from Table 1 of
@fortyeight{} (the control-key representation has been added).

@cindex control characters table
@cindex table of control characters
@multitable @columnfractions .10 .10 .20 .10 .10 .20
@headitem Hex @tab Key @tab Name
@tab      Hex @tab Key @tab Name
@c
@item x00 @tab ^@@ @tab NUL
@tab  x10 @tab ^P @tab DLE
@c
@item x01 @tab ^A @tab SOH
@tab  x11 @tab ^Q @tab DC1
@c
@item x02 @tab ^B @tab STX
@tab  x12 @tab ^R @tab DC2
@c
@item x03 @tab ^C @tab ETX
@tab  x13 @tab ^S @tab DC3
@c
@item x04 @tab ^D @tab EOT
@tab  x14 @tab ^T @tab DC4
@c
@item x05 @tab ^E @tab ENQ
@tab  x15 @tab ^U @tab NAK
@c
@item x06 @tab ^F @tab ACK
@tab  x16 @tab ^V @tab SYN
@c
@item x07 @tab ^G @tab BEL
@tab  x17 @tab ^W @tab ETB
@c
@item x08 @tab ^H @tab BS
@tab  x18 @tab ^X @tab CAN
@c
@item x09 @tab ^I @tab TAB
@tab  x19 @tab ^Y @tab EM
@c
@item x0A @tab ^J @tab LF
@tab  x1A @tab ^Z @tab SUB
@c
@item x0B @tab ^K @tab VT
@tab  x1B @tab ^[ @tab ESC
@c
@item x0C @tab ^L @tab FF
@tab  x1C @tab ^\ @tab IS4
@c
@item x0D @tab ^M @tab CR
@tab  x1D @tab ^] @tab IS3
@c
@item x0E @tab ^N @tab SO
@tab  x1E @tab ^^ @tab IS2
@c
@item x0F @tab ^O @tab SI
@tab  x1F @tab ^_ @tab IS1
@c
@item x7F @tab ^? @tab DEL
@tab @tab @tab
@end multitable

@node Escape-Sequence Lines, Label Lines, Control-Character Lines, Output Format
@section Escape-Sequence Lines
@cindex escape-sequence lines

Escape-sequence lines, which begin with the colon, @samp{:}, don't add
any new semantics---any characters in an escape-sequence line could be
represented on control-character and text lines (and, with just a
one-character change in the escape sequence, would be). But they
serve to set escape sequences apart from normal control-character or
text lines, making it easier to see on one line all the characters
that contribute to a single control function, rather than splitting
them between control-character and text lines.
Here's an example with some intermixed escape-sequence and text lines
(without the usual label and description lines, which are described in
later sections):

@example
|Well |
: Esc [ 3 ; 31 m
|Daniel|
: Esc [ 23 ; 39 m
| didn't do it...|.
@end example

@noindent
The two escape-sequence lines represent, respectively, controls that
set text rendering to use italics in the color red, and to set normal
font rendering in the default color (the actual interpretation of
these controls may vary by application).

Note that the escape-sequence lines include control characters (well,
character, namely @samp{Esc}) intermixed with normal text
characters. So the above could have been written like:

@example
|Well |
. ESC
|[3;31mDaniel|
. ESC
|[23;39m didn't do it...|.
@end example

@noindent
But this loses the separation between characters that, yes, happen to
be text characters, but really just contribute to some terminal
control function invocation, and characters that are, really and
truly, text.

@example
: Esc [ 3 ; 31 m
@end example

@noindent
Some things to note. First, the escape key is noted as @samp{Esc}, and
not @samp{ESC} as it would be in a control-character line. Don't ask
me why; maybe I just felt it was one more thing to dilineate between
escape-sequence lines and control-character lines.

Also, each character is separated from its neighbors by a single
space, except that strings of digits are lumped all together.

Each character is represented by itself (including colon, as long as
it's not at the start of the line), except the escape character, and
the space character (represented as @samp{Spc}). Control characters
and high-value bytes are not currently represented on escape-sequence
lines (they are not part of any escape sequences Teseq recognizes), but
if they are in the future (say, as part of non-standardized escape
sequences), they will most likely be represented as @samp{xXX}
hexadecimal strings (as high-value bytes are represented in
control-character lines.

If an escape sequence requires more than one output line, the
continuing lines will also begin with a colon, followed by two spaces
(instead of one). Lines will not be split in the middle of a number.

@example
: Esc [ 1 ; 2 ; 3 ; 4
:  ; 5 ; 6 ; 7 m
@end example

@menu
* Escape Sequence Recognition::  
@end menu

@node Escape Sequence Recognition,  , Escape-Sequence Lines, Escape-Sequence Lines
@unnumberedsubsec Recognizing Escape Sequences
@cindex escape sequence, defined

Okay, great, so escape-sequence lines help distinguish
control-characters and text characters that make up an escape sequence
from those that don't. But what exactly makes up an escape sequence,
anyway?

The @thirtyfive{} standard defines an escape sequence to be a sequence
of characters beginning with @sc{esc}, with a
@cindex final byte
@cindex escape sequence, final byte
final byte in the range
@code{x30}--@code{x7E}, and any number (including zero) of
@cindex intermediate byte
@cindex escape sequence, intermediate byte
intermediate bytes in the range @code{x20}-@code{x2F}.
@ifinfo
The following table
@end ifinfo
@ifnotinfo
@ref{ascii}
@end ifnotinfo
has been provided as a reference for finding which characters match
which codes.

@float Table,ascii
@cindex table of printable ASCII characters
@multitable {@th{xFF}} {Spc} {Spc} {Spc} {Spc} {Spc} {Spc}
@headitem @tab x2X @tab x3X @tab x4X @tab x5X
@tab x6X @tab x7X
@c
@item @th{xX0} @tab @sc{spc} @tab 0 @tab @@ @tab P
@tab ` @tab p
@c
@item @th{xX1} @tab ! @tab 1 @tab A @tab Q @tab a @tab q
@c
@item @th{xX2} @tab " @tab 2 @tab B @tab R @tab b @tab r
@c
@item @th{xX3} @tab # @tab 3 @tab C @tab S @tab c @tab s
@c
@item @th{xX4} @tab $ @tab 4 @tab D @tab T @tab d @tab t
@c
@item @th{xX5} @tab % @tab 5 @tab E @tab U @tab e @tab u
@c
@item @th{xX6} @tab & @tab 6 @tab F @tab V @tab f @tab v
@c
@item @th{xX7} @tab ' @tab 7 @tab G @tab W @tab g @tab w
@c
@item @th{xX8} @tab ( @tab 8 @tab H @tab X @tab h @tab x
@c
@item @th{xX9} @tab ) @tab 9 @tab I @tab Y @tab i @tab y
@c
@item @th{xXA} @tab * @tab : @tab J @tab Z @tab j @tab z
@c
@item @th{xXB} @tab + @tab ; @tab K @tab [ @tab k @tab @{
@c
@item @th{xXC} @tab , @tab < @tab L @tab \ @tab l @tab |
@c
@item @th{xXD} @tab - @tab = @tab M @tab ] @tab m @tab @}
@c
@item @th{xXE} @tab . @tab > @tab N @tab ^ @tab n @tab ~
@c
@item @th{xXF} @tab / @tab ? @tab O @tab _ @tab o @tab @sc{del}
@end multitable
@end float

@noindent
So, for instance, the following is a valid escape sequence.

@example
: Esc $ ( C
@end example

@noindent
@samp{$} and @samp{(} have code values @code{x24} and @code{x28}, and
so are valid intermediate bytes; @samp{C} has the value @code{x43},
and so terminates the escape sequence.

You may have noticed that a lot of the examples of escape sequences in
this document don't actually follow this format. For instance, 

@example
: Esc [ 3 ; 31 m
@end example

@noindent
According to the definition we just gave, @samp{[} should be the final
byte of an escape sequence. So why does Teseq keep going until it
reaches the @samp{m}?

The answer is that the escape sequence @emph{does} end with the
@samp{[}; but the combination @samp{Esc [} invokes a control named
@code{CONTROL SEQUENCE INTRODUCER}
@cindex @sc{csi}
(@sc{csi}). The @sc{csi} control
marks the beginning of a different kind of sequence, called a
@cindex control sequence
``control sequence''. Control sequences are described by the
@fortyeight{} standard, which considers it to be a distinct concept
from escape sequences; however, Teseq treats both types of sequences as
``escape sequences''.

A control sequence starts with the two-character @sc{csi} escape
sequence @samp{Esc [}, followed by an optional sequence of
@cindex parameter byte
parameter bytes in the range @code{x30}--@code{x3F}, an optional
sequence of
@cindex intermediate byte
intermediate bytes in the range @code{x20}--@code{x2F} (the same range
as intermediate bytes in a regular escape sequence), and a
@cindex final byte
final byte in the range @code{x40}--@code{x7e}. The set of standard
control sequence functions are defined in @fortyeight{}.

When used in accordance with the standard, the parameter bytes are
used to provide a semicolon-separated list of numeric parameters to
the control function being invoked. These affect the details of the
control function's behavior; but not which control function is being
invoked:

@example
: Esc [ 1 m
& SGR: SELECT GRAPHIC RENDITION
" Set bold text.
: Esc [ 0 m
& SGR: SELECT GRAPHIC RENDITION
" Clear graphic rendition to defaults.
@end example

@noindent
Both sequences end with the same sequence of intermediate bytes (none)
and final byte; both invoke the @sc{sgr} control function. But the
first one indicates that following text should be rendered boldface,
while the second indicates that text rendering should be restored to
its default settings.

Intermediate bytes, however, together with the final byte, @emph{do}
affect the meaning of the function invoked. Currently, @fortyeight{}
only defines functions for either no intermediate bytes, or a single
space character (@code{x20}) as the intermediate byte.

@example
: Esc [ A
& CUU: CURSOR UP
: Esc [ Spc A
& SR: SCROLL RIGHT
@end example

@noindent
@fortyeight{} describes an alternate representation for @sc{csi}; the
8-bit byte value @code{x9B}. Teseq does not currently treat that value
specially, nor any of the other high-value bytes from the C1 set of
control functions. This is because whether or not those bytes indicate
control functions is dependent upon what character encoding is in
use. Future versions of Teseq may support an option to interpret these
forms as well, at which time control sequences using the single-byte
@sc{csi} control will probably be rendered like:

@example
: CSI [ 1 m
@end example

@noindent
@fortyeight{} also describes another kind of sequence called
@cindex control string
``control strings''. These are not interpreted by Teseq; the
control characters involved (for example, @samp{SOS/^X} and
@samp{ST/^\} will be printed on control-character lines, and any text
characters will be displayed on text lines.

Future versions of Teseq will probably not depart from this display
behavior; however, support for some common interpretations for control
strings may be added, in which case a label line and/or description
line might follow the control string, describing its usual
interpretation.

@node Label Lines, Description Lines, Escape-Sequence Lines, Output Format
@section Label Lines
@cindex label line

@opindex &
Label lines begin with the ampersand, @samp{&}:

@example
& SGR: SELECT GRAPHIC RENDITION
@end example

@noindent
Label lines always describe a control function, and are always
preceded by the escape sequence that invokes that function (unless the
@opindex -E
@option{-E} option was given, suppressing output for escape-sequence
lines).

The format of a label line's content is always @var{acronym}:
@var{name}; both of these are defined for each control function
by @fortyeight{}.

Label lines currently are never wrapped; however, future
versions of Teseq may wrap label lines. At that time, continuation
label lines will probably consist of an extra space after the
ampersand (similar to how escape-sequence lines are wrapped). Lines
will never be split in the middle of a word.

Future versions of Teseq may use label lines to describe things besides
escape sequences; for instance, control characters or control strings,
or other strings that may be interpreted specially by some devices or
applications.

@node Description Lines,  , Label Lines, Output Format
@section Description Lines
@cindex description line

@opindex "
Description lines begin with the double-quote, @samp{"}:

@example
" Move the cursor up 2 lines.
@end example

@noindent
Sequences of description lines are generally preceded by a label line
(unless the
@opindex -L
@option{-L} option was supplied), and describe the same
control function labeled by that line. More than one description line
may be used to describe a function, whereas only one label line is
ever used for a control function.

It is important to understand that the descriptions provided are only
approximations and guesses, and suffer from various limitations. The
behavior of many control functions are dependent on terminal state
that Teseq does not track. Teseq chooses a common default setting for
applicable terminal modes, and issues a description based on that. For
instance, the @sc{insert line} function is described as follows:

@example
: Esc [ 2 L
& IL: INSERT LINE
" Shift lines after the cursor to make room for 2 new lines.
@end example

@noindent
However, depending on the current setting of the
@sc{line editing mode}, the actual behavior might be to shift the
lines @emph{before} the cursor, rather than the ones after. Future
versions of Teseq may track enough terminal state to improve the
accuracy of these descriptions, but they would still need to
guess at the initial state of the terminal, for any modes that had not
been explicitly set or reset.

Descriptions are also often inaccurate. For instance, the description
for @sc{insert line} should really read ``shift the current line and
the lines after the cursor@dots{}''. In addition, no mention is made of
the fact that the extent of the shifted part is dependent on previous
invocations of @sc{select editing extent}. A conscious decision has
been made to value brevity over accuracy.

Also, the descriptions are based (loosely) on the semantics defined by
@fortyeight{}. There is no guarantee that this corresponds to the
semantics defined for the actual terminal on which these functions
were invoked. The terminal may have different behavior, or may not
even accept the function. The descriptions are intended as a rough aid in
remembering what a given function does; to really understand the
actual semantics of a function, you should read the terminal device's
documentation, and/or @fortyeight{}.

Description lines currently are never wrapped; however, future
versions of Teseq may wrap label lines. At that time, continuation
label lines will probably consist of an extra space after the
double-quote (just as label lines are wrapped). Lines will never be
split in the middle of a word.

Future versions of Teseq may use description lines to describe thigns
besides escape sequences; for instance, control characters or control
strings, or other strings that may be interpreted specially by some
devices or applications. Some description lines may appear without a
preceding label line (even when @option{-L} was not specified), in the
event that no standard designation for the function is known.

@node Standards, Reseq, Output Format, Top
@chapter Standards

The most authoritative source of information on control functions,
their representations in bytes, and their intended meaning, is the
@fortyeight{} standard. Also related is the @thirtyfive{} standard,
which describes control functions for switching the character
encoding, and defines the possible forms of escape sequence (note
that, in Teseq, 
@cindex escape sequence
``escape sequence'' refers to both the Ecma-48 concept of
@cindex control sequence
``control sequences'', and the official Ecma-35 meaning of ``escape
sequence''.

These standards are available, ``free of charge and copyright'', at@*
@uref{http://www.ecma-international.org/}.

@node Reseq, Future Directions, Standards, Top
@chapter The Reseq Command
@cindex @command{reseq}
@cindex Reversing the output of @command{teseq}
@cindex @command{teseq}, reversing the output

Synopsis:

@example
reseq @var{input} @var{output}
reseq -h | --help
reseq -V | --version
@end example

@noindent
Teseq also comes with a @command{reseq} command, which essentially
does the reverse of @command{teseq}. If you feed it the output from
@command{teseq}, it will generate the corresponding escape
sequences---that is, it will generate the same content that was fed to
@command{teseq} to produce that output. The shell command

@example
$ teseq foo | reseq - -
@end example

@noindent
is roughly equivalent to

@example
$ cat foo
@end example

@noindent
The @command{reseq} command is written in
@cindex Perl
Perl, unlike @command{teseq}
which is compiled from C-language sources, and so requires a Perl
interpreter to be present in order to function.

Of the various types of lines output by the @command{teseq} command,
@command{reseq} only understands three;
@cpindex text line
text lines:

@example
|Hello, there|.
|Here are|-
-|some wrapped|-
-|lines|.
@end example

@cpindex control-character line
control-character lines:

@example
. CR/^M LF/^J
. CR LF
@end example

and
@cpindex escape-sequence line
escape-sequence lines:

@example
: Esc [ 31 ; 3 m
@end example

Any other sorts of lines encountered are ignored and discarded, and
have no effect on the output.

@node Future Directions, Copying, Reseq, Top
@chapter Future Directions

Here are some potential additions that may appear in future versions of
Teseq.

@unnumberedsec Unicode Output
Currently, all output from @command{teseq} is in US
@cindex standards
@cindex ASCII
ASCII; but future versions of Teseq might support output in more
extensive character encodings, such as
@cindex UTF-8
UTF-8 or other Unicode-based encodings. If that happens, Teseq might
also add support for the handling of @thirtyfive{} character
code-switching sequences, such that the characters given in
@cindex text line
text lines would reflect the actual characters as they would actually
appear in the terminal device, depending on the current encoding
state.

@unnumberedsec Terminal Database Awareness

Future versions of Teseq may allow the user to specify the name of the
terminal for which the input was intended, which Teseq will then use
to detect when a feature from that terminal's entry in the terminal
database (for example, the
@cindex terminfo
terminfo database) has been invoked.

Since features from terminal database entries often involve multiple
@fortyeight{} controls, Teseq would probably need to indicate out-of-band
``start'' and ``end'' markers for the feature. For instance, if the
definition for the @samp{clear} feature for the specified terminal
is @samp{\E[H\E[J}, then an input string of @samp{\E[m\E[H\E[J\E(B}
might result in output like:

@example
: Esc [ m
# start: clear
: Esc [ H
: Esc [ J
# end: clear
: Esc ( B
@end example

@noindent
(Label and description lines have been removed from this example.)

No commitment has been made to any particular output format for this
feature; the above is intended purely as an example of one possible
approach.

@unnumberedsec Timing Information

One of the useful ways in which @command{teseq} and
@cindex @command{reseq}
@command{reseq} can be used in combination in diagnosing terminal
problems, is to make manual modifications to @command{teseq}'s output,
feeding it back to @command{reseq} to see if there's improvement.

The problem is that, if the input to @command{teseq} was an
interactive terminal session, then simply spitting all of it back out
via @command{reseq} may make it hard to see the trouble spot, if later
controls clear the screen or otherwise obliterate the results you were
trying to see.

Some versions of the @command{script} command (at least, the one from
@uref{ftp://ftp.kernel.org/pub/linux/utils/util-linux/, util-linux})
support an option to produce timing information about a session, so
that it can be replayed (with @command{scriptreplay}) with realistic
timings, so you can actually see everything happening as if it were a
video.

It would be useful for Teseq to handle timing information as well, so
that @command{teseq} could have the option of reading in timing files
from @command{script}, and @command{reseq} would honor these timings,
to produce suitable ``terminal videos''. Even when you're not using
@command{script} timing files, you might want the option of manually
inserting timing information at key locations in @command{teseq}
output files, so you can have @command{reseq} pause long enough for
you to see what's happening.

At such a time that this feature is added, the format of timing lines
will most likely be an initial ``at'' sign @samp{@@}, followed by the
number of seconds to pause:

@example
@@ 3.0051
@end example

@node Copying, Index, Future Directions, Top
@appendix Copying
@include fdl.texi

@node Index,  , Copying, Top
@unnumbered Index

@printindex cp

@bye
